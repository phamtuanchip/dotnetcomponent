<html>
<head>
	<title>Anytime js</title>
<!--
<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css">
<script src="https://ajax.googleapis.com/ajax/libs/jquery/1.12.4/jquery.min.js"></script>
<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js"></script>

<link href="http://ajax.googleapis.com/ajax/libs/jqueryui/1.10.3/themes/smoothness/jquery-ui.css" rel="stylesheet" type="text/css"/>

<script src="http://ajax.googleapis.com/ajax/libs/jquery/1.9.1/jquery.min.js"></script>

<script src="http://ajax.googleapis.com/ajax/libs/jqueryui/1.10.3/jquery-ui.min.js"></script>

-->
<link href="anytime.min.css" rel="stylesheet" type="text/css"/>
<script src="jquery-1.9.1.js"></script>
<script src="jquery-migrate.js"></script>
<script src="anytime.js"></script>
<script src="anytimetz.js"></script>
</style>
</head>
<body>


<style>
#Day, #UntilDay {

background-position:right center;
background-repeat:no-repeat; }
.AnyTime-cur-range{
background-color: #ab6363 !important;
}

</style>
<div  style="float:left;">
Start: <input type="text" id="Day" size="14" value="10-06-2016" />
Until: <input type="text" id="UntilDay" size="14" value="10-07-2016" />
</div>
<div style=" margin-left: 500px; position:fixed;">
<span  style="float:left;" id="span-begin" >
<input type="text" id="rangeDay" size="140" />
</span>
<div class="rangeDemo"></div>
</div>
<div style="clear:both;"></div>

<div>
<input type="checkbox" id="weekend" checked /> Include weekend and public & holiday
</div>
<div>
<input type="text" id="holiday" value="10-11-2016,10-19-2016"/>

</div>

 


<div>
Frequance report
<select>
<option>Daily</option>
</select>
</div>




</body>



<script>
	var oneDay = 24*60*60*1000;
	var rangeDemoFormat = "%m-%d-%Y";
	var formater = "%W, %M %D in the Year %z %E";
	var rangeConv = new AnyTime.Converter({format:rangeDemoFormat});
	
	
	var Dict = (function(){
    // IE 8 and earlier has no Array.prototype.indexOf
		function indexOfPolyfill(val) {
		  for (var i = 0, l = this.length; i < l; ++i) {
			if (this[i] === val) {
			  return i;
			}
		  }
		  return -1;
		}

		function Dict(){
		  this.keys = [];
		  this.values = [];
		  if (!this.keys.indexOf) {
			this.keys.indexOf = indexOfPolyfill;
		  }
		};

		Dict.prototype.has = function(key){
		  return this.keys.indexOf(key) != -1;
		};

		Dict.prototype.get = function(key, defaultValue){
		  var index = this.keys.indexOf(key);
		  return index == -1 ? defaultValue : this.values[index];
		};

		Dict.prototype.set = function(key, value){
		  var index = this.keys.indexOf(key);
		  if (index == -1) {
			this.keys.push(key);
			this.values.push(value);
		  } else {
			var prevValue = this.values[index];
			this.values[index] = value;
			return prevValue;
		  }
		};

		Dict.prototype.delete = function(key){
		  var index = this.keys.indexOf(key);
		  if (index != -1) {
			this.keys.splice(index, 1);
			return this.values.splice(index, 1)[0];
		  }
		};

		Dict.prototype.clear = function(){
		  this.keys.splice(0, this.keys.length);
		  this.values.splice(0, this.values.length);
		};

		return Dict;
	})();

	
	var selectedDays = new Dict();
	
	function thirdtyDays(fromDate) {
			var thirdtyDaysLater = new Date(fromDate+(30*oneDay));
			thirdtyDaysLater.setHours(23,59,59,999);
			return thirdtyDaysLater;
	}
	function oneDays (fromDate) {
		var dayLater = new Date(fromDate+oneDay);
		dayLater.setHours(0,0,0,0);
		return dayLater;
	}
	
	  
  var dpicker =	$("#Day").AnyTime_picker({
		format:rangeDemoFormat
		 
	});
	 
	 
	 var v = oneDays(new Date().getTime());
	 var y = thirdtyDays(new Date().getTime());
	$("#UntilDay").AnyTime_noPicker().AnyTime_picker(
	{
					earliest: v
					,format: rangeDemoFormat
					,latest: y
					
	});
	$("#rangeDay").AnyTime_picker(
	{
		format:rangeDemoFormat
		,placement: "inline"
		,hideInput: false
		 
	});	
	 $("#AnyTime--Day").on("click", ".AnyTime-wk > td:not(.AnyTime-dom-btn-empty)", function (e) {
        if (!$(this).closest(".calendarView").length) {
		    //console.log(e);
			 //var start = $("#AnyTime--Day");
			 //selectedDays.push(rangeConv.parse(start).getTime()); 
            $(this).closest(".AnyTime-pkr").hide();
        }   
    });
	
	
	$("#AnyTime--UntilDay").on("click", ".AnyTime-wk > td:not(.AnyTime-dom-btn-empty)", function (e) {
        if (!$(this).closest(".calendarView").length) {
		    
			 var start = $("#Day").val();
			 var startMin = rangeConv.parse(start).getTime();
			 var end = $("#UntilDay").val();
			 var endMin = rangeConv.parse(end).getTime();
			 var dayLater = oneDays(startMin);
			 var thirdtyDaysLater = thirdtyDays(startMin);
			 selectedDays.clear();
			 var isWeekend = $("#weekend").prop('checked');
			 var holy = $("#holiday").val().split(",");
			 console.log(holy);
			 while( startMin <= endMin ){
			  var cur = rangeConv.format(new Date(startMin));
			  if(isWeekend) {
				 var dow = new Date(startMin).getDay();				  
				  //console.log(cur);
				   if(dow != 0 && dow != 6 && holy.indexOf(cur) ==-1){
					selectedDays.set(cur, startMin);
				   }
				    
				   
			  } else {
				selectedDays.set(cur, startMin);
			  }
			  startMin += oneDay;
			 }
			 console.log(selectedDays.keys);	 
			 var selectedMonth = $("#AnyTime--rangeDay").find(".AnyTime-mons >li ");
			  
			  var month = 0;
			  		 
				selectedMonth.each(function (index, value){
						if($(value).hasClass("ui-state-highlight"))
						month = index +1
						 
				});
			   
			 var hilighable = $("#AnyTime--rangeDay").find(".AnyTime-wk > td:not(.ui-state-disabled)");			  
			 hilighable.removeClass("AnyTime-cur-range");
			  
			hilighable.each(function (index, value){
				
				selectedDays.values.forEach(function (val) {
					   var hightlitedDate = new Date(val).getDate();
					   var hightlitedMonth = new Date(val).getMonth();
					  
					  
					   if(month == (hightlitedMonth +1) && $(value).html() == hightlitedDate)  {
						 $(value).addClass("AnyTime-cur-range");
						  
					   }  
						
					  
				 });
					  
			});
			
            $(this).closest(".AnyTime-pkr").hide();
        }   
    });
	
	
	$("#AnyTime--rangeDay").on("click", ".AnyTime-wk > td:not(.AnyTime-dom-btn-empty)", function (e) {
        
			var selected = $("#rangeDay").val();
			 
			var selectedMin = rangeConv.parse(selected).getTime();
			
			if(!selectedDays.get(selected)) {
				selectedDays.set(selected, selectedMin);
			} else {
				selectedDays.delete(selected);
			}
		    
			$("#rangeDay").val(selectedDays.keys);
			$(".rangeDemo").html("");
			
			selectedDays.keys.forEach(function (day) {
				var input = '<input type="text" name= "rangeValues" value="' + day + '"/>'; 
				 $(".rangeDemo").append(input); 
			}) ;
			
			$(e.target).toggleClass("AnyTime-cur-range"); 
           
        
    });
	
	
         
       
        
	/*
	$("#Day").AnyTime_noPicker().AnyTime_picker({
		format:rangeDemoFormat		
	}).change(function(e) {
	//Calculate and limited day for until
			var fromDay = rangeConv.parse($(e.target).val()).getTime();
			var dayLater = new Date(fromDay+oneDay);
			dayLater.setHours(0,0,0,0);

			var thirdtyDaysLater = new Date(fromDay+(30*oneDay));
			thirdtyDaysLater.setHours(23,59,59,999);
		
			try {
				$("#UntilDay").AnyTime_noPicker().AnyTime_picker(
				{
					earliest: dayLater
					,format: rangeDemoFormat
					,latest: thirdtyDaysLater
					
				}).change(function(e) {
						 
					 
							var selected_begin = rangeConv.parse($("#Day").val()).getTime();
							 
							 selectedDays =[];
							   try {
								 
									var selected_end = rangeConv.parse($("#UntilDay").val()).getTime();
									
									 
									while (selected_begin <= selected_end ){
										selectedDays.push(selected_begin);
										selected_begin += oneDay;
									}
							 
								calculate(selected_begin, selected_end, selectedDays);
								} catch (e) {
									console.log(e);
								}
							
				});

				$("#rangeDay").AnyTime_noPicker().AnyTime_picker(
				{
					earliest: dayLater
					,format: rangeDemoFormat
					,latest: thirdtyDaysLater
					,placement: "inline"
					,hideInput: false
					,isMultiple: true
					,values: selectedDays
					
				}).change(function(e) {
						var begin_range = $("#span-begin table").find(".ui-state-default");
							//var end_range = $("#span-end table").find(".ui-state-default");
							var selected_begin = rangeConv.parse($("#Day").val()).getTime();
							//var selected_end = rangeConv.parse($("#UntilDay").val()).getTime();
						  
					       try {
							//if($("#UntilDay").val() != null && $("#UntilDay").val() != "") {
								var selected_end = rangeConv.parse($("#rangeDay").val()).getTime();
								
							 calculate(selected_begin, selected_end, selectedDays);
							
							} catch (e) {
								console.log(e);
							}
							//console.log($(selectedDays.length));
							
						//calculate(selected_begin, selected_end, selectedDays);
				    });
					
			} catch (e) {
				console.log(e);
				
			}			
		});
*/
	function calculate(selected_begin, selected_end, selected) {
		//Hiligheted the begin
		//selected = $.unique(selected);
	
		var date_begin = new Date(selected_begin +0) ;
		var date_end = new Date(selected_end +0) ;
		//clear hiligherd class
		var selectedMoth = $("#span-begin ul.AnyTime-mons").find("li.ui-state-highlight");
		 var begin_range = $("#span-begin table").find(".ui-state-default");
		begin_range.each(function(key, value) {
			$(value).removeClass("AnyTime-cur-rank");
		});
		//console.log(selectedMoth.length);
		 var selectMonth = selectedMoth.attr("class").substring(39,41);
		 console.log(isNaN(selectMonth));
		if(isNaN(selectMonth))
			selectMonth = selectedMoth.attr("class").substring(39,40);
		begin_range.each(function(key, value) {
			if(selected && selected.length > 0 ) {
				$(selected).each(function(key2, value2){
                   console.log(selectMonth);				
				   if(selectMonth == date_begin.getMonth())
				   if($(value).html() >= date_begin.getDate() && $(value).html() < date_end.getDate() && !$(value).hasClass("ui-state-disabled")) {
					//console.log($(value).hasClass("ui-state-disabled"));
					 ;
					  
											$(value).addClass("AnyTime-cur-rank");
											 
					  
					}
				});
			}
			
		});
		
		 

	}

	$(document).ready(function() {
	//Anytime.picker("test");

	});
</script>
</html>